# Bot Changelog v3.7.0 - Auto-Delete Audio After Playback

**Release Date:** 2025-12-17

## Storage Optimization

### Auto-Delete All Audio Files After Playback
- SEMUA file audio sekarang langsung dihapus setelah selesai diputar
- Sebelumnya hanya file >100MB yang dihapus, sekarang SEMUA file dihapus
- Menghemat storage secara signifikan untuk server dengan kapasitas terbatas

### Files Modified
- `ui/media_player.py` - Renamed `_cleanup_large_audio_file()` to `_cleanup_audio_file()`, always deletes files
- `services/audio/download_manager.py` - Updated `_cleanup_old_tracks()` to always delete files
- `services/audio/playlist_cache.py` - Updated `_cleanup_track()` with better logging

### Behavior Changes
- File dari FTP cache: diunduh, diputar, lalu langsung dihapus dari local
- File download sementara: langsung dihapus setelah playback selesai
- FTP cache tetap menyimpan file untuk penggunaan ulang di masa depan
- Log lebih jelas menampilkan ukuran file yang dihapus

---

## Bug Fixes

### Playlist No Longer Interrupts Current Playback
- **BUG:** Ketika ada audio sedang diputar dan seseorang menambahkan playlist Spotify, audio langsung di-skip
- **FIX:** Sekarang jika bot sudah memutar, playlist baru akan masuk ke queue tanpa mengganggu playback saat ini
- `commands/play.py` - Tambah check `is_already_playing` di `on_first_track` callback untuk Spotify

### Audio Cleanup Not Working - FIXED
- **BUG:** File audio tidak dihapus setelah playback, menyebabkan disk penuh
- **ROOT CAUSE 1:** `_play_next_from_queue` menggunakan `file_path` yang tidak ada, seharusnya `audio_path`
- **ROOT CAUSE 2:** Streaming mode tidak memiliki `audio_path` jadi cleanup tidak berjalan
- **FIX:** Implementasi 2-pronged cleanup approach:
  1. Delete known `audio_path` jika ada
  2. Aggressively search downloads folder untuk file yang cocok dengan track yang diputar
- `ui/media_player.py` - Updated `_cleanup_audio_file()` dan `_play_next_from_queue()`
